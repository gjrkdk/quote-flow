---
phase: 12-admin-ui-option-groups
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/routes/app.option-groups._index.tsx
  - app/routes/app.tsx
autonomous: true

must_haves:
  truths:
    - "Merchant can see a list of all option groups with name, type, choice count, and product count"
    - "Merchant can delete an option group via modal confirmation with product usage warning"
    - "Option Groups link appears in admin sidebar navigation"
    - "Empty state with clear CTA is shown when no option groups exist"
  artifacts:
    - path: "app/routes/app.option-groups._index.tsx"
      provides: "Option group list page with IndexTable and delete modal"
      exports: ["loader", "action", "default"]
    - path: "app/routes/app.tsx"
      provides: "Navigation link to Option Groups"
      contains: "option-groups"
  key_links:
    - from: "app/routes/app.option-groups._index.tsx"
      to: "app/services/option-group.server.ts"
      via: "listOptionGroups and deleteOptionGroup service calls"
      pattern: "listOptionGroups|deleteOptionGroup"
    - from: "app/routes/app.tsx"
      to: "app/routes/app.option-groups._index.tsx"
      via: "navigation link /app/option-groups"
      pattern: "option-groups"
---

<objective>
Create the option groups list page with IndexTable, delete modal with product usage warning, empty state, and add navigation link to admin sidebar.

Purpose: Merchants need a central place to view and manage all their option groups, matching the existing matrices list page pattern.
Output: Functional list page accessible from sidebar navigation with full CRUD support for delete operations.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@app/routes/app.matrices._index.tsx
@app/routes/app.tsx
@app/services/option-group.server.ts
@app/validators/option-group.validators.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create option groups list page with IndexTable and delete modal</name>
  <files>app/routes/app.option-groups._index.tsx</files>
  <action>
Create app/routes/app.option-groups._index.tsx following the EXACT pattern from app/routes/app.matrices._index.tsx.

**Loader:**
- Authenticate with `authenticate.admin(request)` to get session
- Find store by `session.shop`
- Call `listOptionGroups(store.id)` from `~/services/option-group.server`
- Serialize response: map each group to `{ id, name, requirement, choiceCount: group._count.choices, productCount: group._count.products }`
- Return `json({ optionGroups: serialized })`

**Action:**
- Handle `intent === "delete"` with `groupId` from formData
- Authenticate, find store, call `deleteOptionGroup(groupId, store.id)`
- Return `json({ success: true })` or error responses

**Component (OptionGroupsIndex):**
- Define `OptionGroup` interface: `{ id, name, requirement, choiceCount, productCount }`
- Use `useLoaderData`, `useNavigate`, `useFetcher`
- State: `deleteModalOpen`, `groupToDelete`, `deletedGroupId`
- Refs: `rowRefs` Map for focus management after delete

**Empty state (when optionGroups.length === 0):**
- Use `EmptyState` component with heading "Create your first option group"
- Action button navigates to `/app/option-groups/new` with id="create-group-btn"
- Description: "Option groups let customers choose add-ons like material, finish, or size. Create groups with choices and assign them to products."
- Use same Shopify placeholder image as matrices page

**IndexTable (when optionGroups populated):**
- Page title "Option Groups" with primaryAction "Create option group" -> `/app/option-groups/new`
- Wrap in `Box paddingInline` and `Card padding="0"` (matches matrices pattern)
- 5 columns: Name (semibold), Type (Required/Optional), Choices ("N choices"), Used by ("N products"), Actions
- Row onClick navigates to `/app/option-groups/${group.id}/edit`
- Action buttons in div with stopPropagation: Edit (plain) and Delete (plain, critical tone)
- `selectable={false}`, `condensed` on IndexTable
- resourceName: `{ singular: "option group", plural: "option groups" }`

**Delete modal:**
- Title: "Delete option group"
- Primary action: destructive "Delete" button calling handleDeleteConfirm
- Secondary action: "Cancel"
- Body: "This will permanently delete the option group "{name}"."
- If productCount > 0: critical tone warning "This option group is assigned to N product(s). It will be removed from all products."

**Focus management after delete:**
- Track `deletedGroupId` state
- useEffect watches `fetcher.state === "idle" && fetcher.data && deletedGroupId`
- If no groups remain: focus "create-group-btn" via setTimeout(100)
- If groups remain: focus first row via rowRefs Map
- Use same ref pattern as matrices: span with ref callback, tabIndex={-1}, style outline none

**handleDeleteConfirm:**
- Submit via fetcher with intent "delete" and groupId
- Close modal, set deletedGroupId, clear groupToDelete
  </action>
  <verify>
Run `npx tsc --noEmit` and confirm no new TypeScript errors in option-groups files. Navigate to /app/option-groups in browser (dev server) and verify empty state renders.
  </verify>
  <done>Option groups list page renders with empty state, IndexTable with all columns, delete modal with product usage warning, and focus management after delete.</done>
</task>

<task type="auto">
  <name>Task 2: Add Option Groups navigation link to admin sidebar</name>
  <files>app/routes/app.tsx</files>
  <action>
Edit app/routes/app.tsx to add "Option Groups" link in the `ui-nav-menu` component.

Add the link between "Matrices" and "Settings":
```
<Link to="/app/option-groups">Option Groups</Link>
```

The full nav menu should be:
1. Dashboard (home)
2. Matrices
3. Option Groups (NEW)
4. Settings
  </action>
  <verify>
Run `npx tsc --noEmit` and confirm no errors. Load the app and verify "Option Groups" appears in the sidebar navigation between Matrices and Settings.
  </verify>
  <done>Admin sidebar shows "Option Groups" navigation link that routes to /app/option-groups.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes without new errors in option-group route files
2. Navigate to /app/option-groups â€” empty state renders with "Create option group" CTA
3. Navigation sidebar shows "Option Groups" link between Matrices and Settings
4. After creating option groups (via Plan 02), list page shows IndexTable with all 5 columns
5. Delete modal shows product usage warning when group is assigned to products
</verification>

<success_criteria>
- Option groups list page accessible at /app/option-groups
- Empty state shown for stores with no option groups
- IndexTable renders name, type, choices count, products count, and action buttons
- Delete modal with destructive action and product usage warning
- Navigation link in sidebar
- Focus management after delete (accessibility)
</success_criteria>

<output>
After completion, create `.planning/phases/12-admin-ui-option-groups/12-01-SUMMARY.md`
</output>
