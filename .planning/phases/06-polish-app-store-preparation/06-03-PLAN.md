---
phase: 06-polish-app-store-preparation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/MatrixGrid.tsx
  - app/routes/app._index.tsx
  - app/routes/app.matrices._index.tsx
autonomous: true

must_haves:
  truths:
    - "Arrow keys move focus between matrix grid cells"
    - "Tab key moves focus out of grid to next page element (not cell-by-cell)"
    - "Enter key enters edit mode on focused cell"
    - "Escape key exits edit mode"
    - "Screen readers announce row and column headers when navigating cells"
    - "Dashboard stacks to single column on tablet-width screens"
    - "Matrix list goes full-width on tablet screens"
    - "Matrix grid scrolls horizontally on small screens"
  artifacts:
    - path: "app/components/MatrixGrid.tsx"
      provides: "Accessible matrix grid with ARIA grid role and keyboard navigation"
      contains: "role=\"grid\""
    - path: "app/routes/app._index.tsx"
      provides: "Responsive dashboard layout"
      contains: "Grid"
    - path: "app/routes/app.matrices._index.tsx"
      provides: "Responsive matrix list"
  key_links:
    - from: "app/components/MatrixGrid.tsx"
      to: "ARIA grid pattern"
      via: "role attributes and keyboard handlers"
      pattern: "onKeyDown.*ArrowRight|ArrowLeft|ArrowDown|ArrowUp"
---

<objective>
Add WCAG 2.1 AA accessibility to the matrix grid editor (keyboard navigation, ARIA roles, screen reader support) and make dashboard + matrix list responsive for desktop and tablet.

Purpose: App Store requires accessibility compliance and responsive UI. The matrix grid is the most complex interactive component and needs full keyboard navigation per W3C ARIA grid pattern.

Output: Accessible MatrixGrid component with full keyboard navigation, responsive dashboard and matrix list.
</objective>

<execution_context>
@/Users/robinkonijnendijk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/robinkonijnendijk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-polish-app-store-preparation/06-CONTEXT.md
@.planning/phases/06-polish-app-store-preparation/06-RESEARCH.md
@app/components/MatrixGrid.tsx
@app/routes/app._index.tsx
@app/routes/app.matrices._index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ARIA grid keyboard navigation to MatrixGrid</name>
  <files>app/components/MatrixGrid.tsx</files>
  <action>
    Refactor MatrixGrid.tsx to implement W3C ARIA grid pattern with full keyboard navigation.

    ARIA Structure Changes:
    - Add `role="grid"` to the `<table>` element
    - Add `aria-label="Price matrix editor"` to the table
    - Add `role="row"` to all `<tr>` elements
    - Add `role="columnheader"` to width breakpoint `<th>` elements in thead
    - Add `role="rowheader"` to height breakpoint `<th>` elements in tbody
    - Add `role="gridcell"` to all `<td>` elements containing price inputs
    - Add `aria-label` to each input: e.g., `Price for {widthBp} {unit} width by {heightBp} {unit} height`

    Keyboard Navigation (roving tabindex):
    - Track focused cell with React state: `[focusRow, focusCol]` starting at [0, 0]
    - Only the focused cell's `<td>` gets `tabIndex={0}`, all others get `tabIndex={-1}`
    - Use `useRef` + `useEffect` to programmatically focus the active cell when focusRow/focusCol changes

    Keyboard Handlers (on each `<td>` gridcell):
    - ArrowRight: Move focus to next column (stop at last column)
    - ArrowLeft: Move focus to previous column (stop at first column)
    - ArrowDown: Move focus to next row (stop at last row)
    - ArrowUp: Move focus to previous row (stop at first row)
    - Enter: Focus the `<input>` inside the cell (enter edit mode)
    - Escape: Blur the `<input>`, return focus to the `<td>` (exit edit mode)
    - Tab: Default behavior - moves focus OUT of grid to next page element (do NOT preventDefault on Tab)
    - Home: Move to first cell in current row
    - End: Move to last cell in current row

    All arrow key handlers must call `e.preventDefault()` to prevent scrolling.

    Focus Visual Indicator:
    - Add CSS outline to focused cell: `outline: 2px solid #2c6ecb; outline-offset: -2px;`
    - Remove the existing onFocus/onBlur inline style handlers on inputs (replaced by grid-level focus management)

    Color Contrast Audit:
    - Empty cell background (#fff4f4) with text: verify contrast. The red background for empty cells is very light; ensure any text on it meets 4.5:1 ratio. The current red (#fff4f4) on white is just a highlight, not text background, so it's OK as a UI indicator (3:1 ratio for non-text elements).
    - Remove button color (#bf0711) on transparent/white: verify meets 4.5:1. #bf0711 on white = ~5.5:1, passes.
    - Add button color (#2c6ecb) on white: verify meets 4.5:1. #2c6ecb on white = ~4.6:1, passes.

    Focus Management After Delete:
    - When a breakpoint is removed (onRemoveWidthBreakpoint/onRemoveHeightBreakpoint), if the focused cell is beyond the new grid bounds, clamp focusRow/focusCol to the new max indices.

    Keep the existing `overflowX: "auto"` wrapper for responsive horizontal scrolling (already implemented per CONTEXT.md decision).
  </action>
  <verify>
    `npx tsc --noEmit` passes. Grep for `role="grid"` in MatrixGrid.tsx to confirm ARIA structure. Grep for `ArrowRight` to confirm keyboard handlers exist.
  </verify>
  <done>MatrixGrid has full ARIA grid role structure, roving tabindex keyboard navigation (arrows, Enter, Escape, Home, End), proper aria-labels on inputs, and focus management. Horizontal scroll preserved for small screens.</done>
</task>

<task type="auto">
  <name>Task 2: Make dashboard and matrix list responsive</name>
  <files>app/routes/app._index.tsx, app/routes/app.matrices._index.tsx</files>
  <action>
    **app._index.tsx (Dashboard):**
    Import `Grid` from `@shopify/polaris`. Wrap the dashboard content cards in a responsive Grid layout:
    - `<Grid columns={{xs: 1, sm: 1, md: 2, lg: 2, xl: 2}} gap="400">`
    - Each card (welcome card, API key card, stats cards) becomes a `<Grid.Cell>`
    - On desktop (md+): 2-column layout
    - On tablet/mobile (xs, sm): single column stack
    - Keep existing card content unchanged, just wrap in Grid structure

    The current dashboard likely uses Layout.Section for cards. Replace the multi-column sections with Grid while keeping Layout for the overall page structure. If the dashboard currently only has a single column of cards stacked with Layout.Section, add Grid around groups of cards that should be side-by-side on desktop (e.g., stats card + API key card).

    **app.matrices._index.tsx (Matrix List):**
    The IndexTable is already full-width by default. Ensure it responds well on tablet:
    - Wrap the IndexTable in a container with responsive padding: use Polaris `Box` with `paddingInline={{xs: "200", md: "400"}}`
    - The table content should naturally flow full-width
    - If there are any fixed-width styles, replace with responsive alternatives
    - Add `condensed` prop to IndexTable for compact display on smaller screens if the table has many columns

    Both files: do NOT change navigation patterns (keep useNavigate, no Polaris url props per project convention).
  </action>
  <verify>
    `npx tsc --noEmit` passes. Grep for "Grid" in app._index.tsx to confirm responsive grid usage.
  </verify>
  <done>Dashboard uses Polaris Grid for 2-column desktop / 1-column tablet layout. Matrix list has responsive padding and full-width layout on tablet.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- MatrixGrid.tsx contains `role="grid"`, keyboard event handlers for arrow keys
- Dashboard uses Polaris Grid component for responsive layout
- Matrix grid retains horizontal scroll wrapper
</verification>

<success_criteria>
- Full keyboard navigation in matrix grid: arrow keys, Enter, Escape, Home, End
- Roving tabindex: only one cell is tabbable at a time
- Screen reader labels on all interactive grid cells
- Dashboard responsive: 2-col desktop, 1-col tablet
- Matrix list responsive: full-width on tablet
- Grid editor: horizontal scroll on small screens (preserved)
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-app-store-preparation/06-03-SUMMARY.md`
</output>
